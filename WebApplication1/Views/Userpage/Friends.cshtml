@using Animerch.Data;
@using Animerch.Models;
@using Microsoft.AspNetCore.Identity;

@model FriendEntry;

@inject UserManager<User> UserManager
@inject SignInManager<User> SignInManager


@{
    ViewData["Title"] = "Friends";
    List<FriendEntry> friendEntries = ViewData["UserFriendListEntries"] as List<FriendEntry>;
    User user = await UserManager.GetUserAsync(User);

    var pendingFriends = friendEntries.Where(FE => FE.UserID == user.Id && FE.FriendID != user.Id).ToList();
    var incomingFriends = friendEntries.Where(FE => FE.UserID != user.Id && FE.FriendID == user.Id).ToList();
    var friends = friendEntries;
}

<h2>Friends</h2>

<h4>Your friends (@friends.Count)</h4>


@if (friends != null)
{
    <table class="table">
        <thead>

        </thead>
        <tbody>
            @foreach (var friend in friends)
            {
                <tr>
                    <td>@friend.Friend.UserName</td>
                    <td>
                        <form asp-action="UserDeleteFriend">
                            <input type="submit" class="btn btn-default" value="Remove Friend" />
                            <input asp-for="UserID" type="hidden" value="@user.Id" />
                            <input asp-for="FriendID" type="hidden" value="@friend.FriendID" />
                        </form>
                    </td>

                </tr>
            }
        </tbody>
    </table>
}

<h4>Pending Friend Requests (@pendingFriends.Count)</h4>

@if (pendingFriends != null)
{
    <table class="table">
        <thead>

        </thead>
        <tbody>
            @foreach (var friend in pendingFriends)
            {
                <tr>
                    <td>@friend.Friend.UserName</td>
                    <td>
                        <form asp-action="UserDeleteFriend">
                            <input type="submit" class="btn btn-default" value="Remove Friend" />
                            <input asp-for="UserID" type="hidden" value="@user.Id" />
                            <input asp-for="FriendID" type="hidden" value="@friend.FriendID" />
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<h4>Incoming Friend Requests(@incomingFriends.Count)</h4>

@if (incomingFriends != null)
{
    <table class="table">
        <thead>

        </thead>
        <tbody>
            @foreach (var friend in incomingFriends)
            {
                <tr>
                    <td>@friend.User.UserName</td>
                    <td>
                        <form asp-action="UserAddFriend">
                            <input type="submit" class="btn btn-default" value="Accept Friend Request" />
                            <input asp-for="UserID" type="hidden" value="@user.Id" />
                            <input asp-for="FriendID" type="hidden" value="@friend.UserID" />
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}



