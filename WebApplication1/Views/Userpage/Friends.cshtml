@using Animerch.Data;
@using Animerch.Models;
@using Microsoft.AspNetCore.Identity;

@inject UserManager<User> UserManager
@inject SignInManager<User> SignInManager


@{
    ViewData["Title"] = "Friends";
    List<FriendEntry> friendEntries = ViewData["UserFriendListEntries"] as List<FriendEntry>;
    User user = await UserManager.GetUserAsync(User);

    int pendingRequests;
    int acceptedRequests;
    int incomingRequests;
    if (friendEntries == null)
    {
        pendingRequests = 0;
        acceptedRequests = 0;
        incomingRequests = 0;
    }
    else
    {
        pendingRequests = friendEntries.Where(f => f.RequestAccepted == false).Count();
        acceptedRequests = friendEntries.Where(f => f.RequestAccepted == true).Count();
        incomingRequests = 0;
    }
}

<h2>Friends</h2>

<h4>Pending Friend Requests (@pendingRequests)</h4>

@if (user.Friends != null)
{
    <table class="table">
        <thead>

        </thead>
        <tbody>
            @foreach (var friend in user.Friends)
            {
                <tr>
                    <td>@friend.UserName</td>
                    <td><input type="submit" class="btn btn-default" value="Remove Friend"/></td>
                </tr>
            }
        </tbody>
    </table>
}

<h4>Your friends (@acceptedRequests)</h4>

@if (user.Friends != null)
{
    <table class="table">
        <thead>

        </thead>
        <tbody>
            @foreach (var friend in user.Friends)
            {
                <tr>
                    <td>@friend.UserName</td>
                    <td><a class="btn">Remove Friend</a></td>
                </tr>
            }
        </tbody>
    </table>
}

<h4>Incoming Friend Requests(@incomingRequests)</h4>

@if (user.Friends != null)
{
    <table class="table">
        <thead>

        </thead>
        <tbody>
            @foreach (var friend in user.Friends)
            {
                <tr>
                    <td>@friend.UserName</td>
                    <td><a class="btn">Remove Friend</a></td>
                </tr>
            }
        </tbody>
    </table>
}



